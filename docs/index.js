!function(e){function t(t){for(var n,r,s=t[0],o=t[1],a=0,u=[];a<s.length;a++)r=s[a],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&u.push(i[r][0]),i[r]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);for(c&&c(t);u.length;)u.shift()()}var n={},i={0:0};function r(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var s=new Promise((function(t,r){n=i[e]=[t,r]}));t.push(n[2]=s);var o,a=document.createElement("script");a.charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.src=function(e){return r.p+""+e+".index.js"}(e);var c=new Error;o=function(t){a.onerror=a.onload=null,clearTimeout(u);var n=i[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+r+": "+s+")",c.name="ChunkLoadError",c.type=r,c.request=s,n[1](c)}i[e]=void 0}};var u=setTimeout((function(){o({type:"timeout",target:a})}),12e4);a.onerror=a.onload=o,document.head.appendChild(a)}return Promise.all(t)},r.m=e,r.c=n,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.oe=function(e){throw console.error(e),e};var s=window.webpackJsonp=window.webpackJsonp||[],o=s.push.bind(s);s.push=t,s=s.slice();for(var a=0;a<s.length;a++)t(s[a]);var c=o;r(r.s=26)}([function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return r}));var i=function(e){var t=this;e&&e.forEach((function(e){var n=s.call(t,e.name,e.scope);t.$world.system(e.components,n)}))},r=function(){try{var e=this.models.scenes[this.currentScene];return void 0!==e&&null!=e.renderers&&e.renderers()?e.renderers():[]}catch(e){console.error("no renderers found for this scene :"+this.currentScene)}},s=function(e,t){try{if("string"!=typeof e||""===e)throw"no system name defined";return this.models.systems[t][e]()[e]}catch(t){throw"no system found with name :"+e}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return r}));var i=function(e){var t=this;e.forEach((function(e){var n=s.call(t,e.name,e.scope);t.$world.system(e.components,n)}))},r=function(){try{var e=this.models.scenes[this.currentScene];return void 0!==e&&null!=e.systems&&e.systems()?e.systems():[]}catch(e){console.error("no systems found for this scene :"+this.currentScene)}},s=function(e,t){try{if("string"!=typeof e||""===e)throw"no system name defined";var n=this.models.systems[t][e]();if(n[e])return n[e];throw"system don't export good systemName"}catch(t){throw"no system found with name :"+e}}},function(e,t,n){"use strict";n.d(t,"c",(function(){return v})),n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return p}));var i=n(3);function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=function e(t){if("object"!==o(t)||null===t)return t;if(Array.isArray(t))return function(e,t){for(var n=Object.keys(e),i=new Array(n.length),r=0;r<n.length;r++){var s=n[r],a=e[s];"object"!==o(a)||null===a?i[s]=a:i[s]=t(a)}return i}(t,e);var n={};for(var i in t){var r=t[i];"object"!==o(r)||null===r?n[i]=r:n[i]=e(r)}return n},c=function(e){var t=this;try{var n="";return e.split(".").forEach((function(e,i){n=0==i?t[e]:n[e]})),n}catch(e){throw e}},u=function e(t,n){arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{for(var i={},r=Object.keys(t),a=0;a<r.length;a++){var u=r[a],h=t[u],f=n[u];if(null==f){if(null==h._default)throw"error missing parameter :"+u;var l=JSON.parse(JSON.stringify(h._default));"ref"===h._type&&(l=c.call(this,l)),i[u]=l}else if(h._type.startsWith("array")&&Array.isArray(f)){i[u]=[];var d=h._type.match("array<(.*)>")[1];if("array"===d)for(var m=0;m<f.length;m++){var p=e.call(this,{array:h["_"+d]},{array:f[m]});i[u].push(p.array)}else if("object"===d)for(m=0;m<f.length;m++)i[u].push(e.call(this,h["_"+d],f[m]));else{if("string"!==d&&"number"!==d&&"boolean"!==d)throw"missing/wrong subType"+d+"in array model for param :"+u;for(m=0;m<f.length;m++){if(d!=o(f[m]))throw"wrong subType"+d+"in array model for param :"+u;i[u].push(f[m])}}}else if("object"!==h._type||"object"!==o(f)||Array.isArray(f))if(h._type===o(f))i[u]=f;else{if("ref"!==h._type||"string"!=typeof f)throw"error wrong type parameters for "+u+": waiting "+h._type+" and get "+o(f);i[u]=c.call(this,f)}else{i[u]={};var y=Object.keys(h).filter((function(e){return!e.startsWith("_")}));for(m=0;m<y.length;m++){var g=y[m],v=f[g]?f[g]:{},x=e.call(this,s({},g,h[g]),s({},g,v));i[u][g]=x[g]}}}return i}catch(e){throw e}},h=function(e,t){return e.reduce((function(e,n){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){s(e,t,n[t])}))}return e}({},e,s({},n[t],n))}),{})},f=function(){try{var e=this.models.scenes[this.currentScene];if(e&&e.entities)return e.entities()}catch(e){console.error("no entities found for this scene :"+this.currentScene)}},l=function(e,t){this.cachedEntities[e.scope]||(this.cachedEntities[e.scope]={}),this.cachedEntities[e.scope][e.name]=a(t)},d=function(e){var t=this;try{var n=[];return e.forEach((function(e){var s=null;if(!s){var a=y.call(t,e),c=h(e.components,"name"),u=function e(){for(var t=function(e){return e&&"object"===o(e)},n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return i.reduce((function(n,i){return Object.keys(i).forEach((function(s){var o=n[s],a=i[s];Array.isArray(o)&&Array.isArray(a)?n[s]=o.concat.apply(o,r(a)):t(o)&&t(a)?n[s]=e(o,a):n[s]=a})),n}),{})}(h(a.components,"name"),c);s=m.call(t,{name:a.name,components:Object.values(u)}),s=new i.a(s.name,s.components),l.call(t,e,s)}n.push(s)})),n}catch(e){console.error(e)}},m=function(e){var t=this;try{var n={name:e.name,components:[]};return e.components.forEach((function(e){var i=p.call(t,e);n.components.push(i)})),n}catch(e){throw e}},p=function(e){try{var t=g.call(this,e),n=e.params?e.params:{},i=u.call(this,t.params,n);return i.name=t.name,i}catch(e){throw e}},y=function(e){try{if("string"!=typeof e.name||""===e.name||"string"!=typeof e.scope||""===e.scope)throw"no entity name defined";return this.models.entities[e.scope][e.name]()}catch(t){throw"no entity found with name :"+e.name+" and scope :"+e.scope}},g=function(e){try{if("string"!=typeof e.name||""===e.name||"string"!=typeof e.scope||""===e.scope)throw"no component name defined";return this.models.components[e.scope][e.name]()}catch(t){throw"no component found with name :"+e.name+" and scope :"+e.scope}},v=function(){var e=f.call(this);return d.call(this,e)}},function(e,t,n){"use strict";function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(e,t){this.components={},this.name=e,this.add=function(e){var t=this;!1===Array.isArray(e)&&(e=[e]),e.forEach((function(e){t.components[e.name]=e}))},this.get=function(e){return this.components[e]},this.has=function(e){!1===Array.isArray(e)&&(e=[e]);for(var t=0,n=e.length;t<n;t+=1){var i=e[t],r=i.replace("not:",""),s=i!==r;if(this.components.hasOwnProperty(r)===s)return!1}return!0},this.remove=function(e){!1===Array.isArray(e)&&(e=[e]);for(var t=0,n=e.length;t<n;t+=1){var i=e[t];!0===this.components.hasOwnProperty(i)&&delete this.components[i]}},this.add(t)}function s(e){this.entities={},this.add=function(e){var t=this;!1===Array.isArray(e)&&(e=[e]),e.forEach((function(e){t.entities[e.name]=e}))},this.get=function(e){return this.entities[e]},this.remove=function(e){!1===Array.isArray(e)&&(e=[e]);for(var t=0,n=e.length;t<n;t+=1){var i=e[t],r=i.name||i;!0===this.entities.hasOwnProperty(r)&&delete this.entities[r]}},this.system=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.entities,s={};Object.entries(r).forEach((function(e){var n=i(e,2),r=n[0],o=n[1];!0===o.has(t)&&(s[r]=o)})),n.call(e,s)}}n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function i(e){return function(t){return Math.pow(t,e)}}function r(e){return function(t){return 1-i(e)(1-t)}}function s(e){return function(t){return t*e}}function o(e){return i(2)(e)}function a(e){return r(2)(e)}function c(e){return function(t){return e(1-t)}}n.d(t,"b",(function(){return r})),n.d(t,"d",(function(){return s})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"e",(function(){return c}))},function(e,t,n){"use strict";n.r(t),n.d(t,"generateDecor",(function(){return s}));var i=n(2);function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function s(e){var t=this,n=this.$world.entities.character.get("position").x,s=n+128,a=n-32,c=["top","bottom","background","water","pipeTop","pipeBottom","cloud"];this.$infos.started&&c.push("checkpoint");for(var u={},h=0;h<c.length;h++){var f=c[h];u[f]={model:this.models.entities.demo[f],width:64,maxPosition:a,maxId:0,entities:[]}}if(u.cloud.width=160,Object.entries(e).filter((function(e){var n=r(e,2),i=n[0],s=n[1],o=i.match(/^([a-zA-Z]+)/)[1],c=s.get("position").x+u[o].width<a;if(c)t.$world.remove(s);else{var h=i.match(/^[a-zA-Z]+([0-9]+)/)[1];u[o].entities.push(s),u[o].maxPosition<s.get("position").x+u[o].width&&(u[o].maxPosition=s.get("position").x+u[o].width,u[o].maxId=parseInt(h)+1)}return!c})),this.$infos.started&&0===u.checkpoint.entities.length){var l=u.pipeTop.maxPosition;u.checkpoint.maxPosition=l}var d={};Object.entries(u).forEach((function(e){for(var n=r(e,2),a=n[0],c=n[1];s>c.maxPosition;){var u=i.b.call(t,[c.model()])[0];!t.$infos.started||"pipeTop"!==a&&"pipeBottom"!==a||(d[c.maxId]||(d[c.maxId]=43*Math.random()+12),u=o(u,d[c.maxId],a)),u.name=u.name+c.maxId,u.get("position").x=c.maxPosition,t.$world.add(u),c.maxPosition=c.maxPosition+c.width,c.maxId=c.maxId+1}}))}var o=function(e,t,n){var i=1,r=[],s=0,o=0,a=0,c=-1,u=96-(t+20),h=e.get("hitbox"),f=0;if("pipeTop"===n)o=-4,a=2,c=1,u=t;else{h.y=16-u;var l=16*(1-(t-12)/43);l<=4?r.push({source:{scope:"demo",file:"pipe-shadow-16x8@1x"},frames:[[0,1,16,16]],frame:0,opacity:1,elapsed:0,framerate:8,destination:[0,14+l,0,16,16]}):(r.push({source:{scope:"demo",file:"pipe-shadow-16x8@1x"},frames:[[0,0,16,16]],frame:0,opacity:1,elapsed:0,framerate:8,destination:[0,-2+l,0,16,16]}),r.push({source:{scope:"demo",file:"pipe-shadow-16x8@1x"},frames:[[0,1,16,16]],frame:0,opacity:1,elapsed:0,framerate:8,destination:[0,10+l,0,16,16]}))}h.height=u+o;for(e.get("images");f<u;){var d=f*c+o;u-f<=16&&(d-=(16-(u-f))*c,i=a,s=1),r.push({source:{scope:"demo",file:"pipe-16x16@1x"},frames:[[0,i,16,16]],frame:0,opacity:1,elapsed:0,framerate:8,destination:[0,d,s,16,16]}),f+=16}return e.get("images").parts=r,e}},function(e,t,n){"use strict";function i(e,t){this.x=e,this.y=t}function r(e,t,n,i){this.height=i,this.width=n,this.x=e,this.y=t}n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,n){"use strict";function i(){this.$controllers.inputs.length=0}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";function i(){}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";function i(){console.log("destroy demo scene"),console.log("-------"),this.$controllers.destroy(),delete this.$camera,delete this.$controllers,delete this.$origins,delete this.$world.entities,delete this.$world,delete this.$systems,delete this.$renderers}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(0);n(12);function r(){this.context.fillStyle="#000000",this.context.fillRect(0,0,this.size.width,this.size.height),i.b.call(this,this.$renderers),this.$camera.render(),this.$cameraInfo.render()}},function(e,t,n){"use strict";n.r(t),n.d(t,"showHitbox",(function(){return s}));var i=n(6);function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function s(e){var t=this;Object.entries(e).forEach((function(e){var n=r(e,2),s=(n[0],n[1]),o=s.get("camera"),a=s.get("hitbox"),c=s.get("origin"),u=s.get("position"),h=o.camera,f=(c.reference,new i.b(h.screen.x()+(u.x+a.x)*h.screen.scale()-(h.position.x()*h.screen.scale()-h.screen.width()/2+h.shaking.shift.x*h.screen.scale()),h.screen.y()+(u.y+a.y)*h.screen.scale()-(h.position.y()*h.screen.scale()-h.screen.height()/2+h.shaking.shift.y*h.screen.scale()),a.width*h.screen.scale(),a.height*h.screen.scale()));t.context.save(),t.context.lineWidth=2,t.context.strokeStyle="#639bff",t.context.strokeRect(f.x+1,f.y+1,f.width-2,f.height-2),t.context.restore()}))}},function(e,t,n){"use strict";function i(){console.log("resize demo scene")}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";function i(){console.log("setup demo scene")}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";function i(e){var t=window.localStorage.getItem(e);return t?JSON.parse(t):t}function r(e,t){window.localStorage.setItem(e,JSON.stringify(t))}n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(1);function r(){i.b.call(this,this.$systems),this.$camera.update(this.delta.update)}},function(e,t,n){"use strict";function i(){}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";function i(){}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";function i(){console.log("destroy loading scene"),console.log("-------"),delete this.state.redirect,delete this.$systems,delete this.$renderers}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(0);function r(){i.b.call(this,this.$renderers),this.context.fillStyle="#181a1f",this.context.fillRect(0,0,this.size.width,this.size.height),this.context.font="16px Courier New",this.context.textAlign="start",this.context.textBaseline="top",this.context.fillStyle="#6b717d",this.context.fillText("/ Theatre",8,8),this.context.fillStyle="#d7dae0",this.context.fillText("$ preloading assets...",8,32),!1===this.preloading&&(this.context.fillText("$ preloading completed",8,56),this.context.fillText("$ loading demo scene...",8,80))}},function(e,t,n){"use strict";function i(){console.log("resize loading scene")}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(0),r=n(1);function s(){console.log("setup loading scene"),this.$renderers=i.a.call(this),this.$systems=r.a.call(this)}},function(e,t,n){"use strict";function i(){console.log("start loading scene"),this.state.redirect=!1}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";function i(){var e=this;!1===this.preloading&&!1===this.state.redirect&&(setTimeout((function(){e.load("demo")}),100),this.state.redirect=!0)}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i=n(2),r=n(4);function s(e,t,n){var i=[];this.name=t,this.position={x:function(){return 0},y:function(){return 0}},this.screen={x:n.x,y:n.y,width:n.width,height:n.height,scale:n.scale},this.shaking={current:!1,duration:0,easing:null,elapsed:0,force:{x:0,y:0},shift:{x:0,y:0}},this.add=function(e){for(var t=0,n=i.length-1;n>=0;n-=1){var r=i[n];if(e.destination.z>r.destination.z||e.destination.z===r.destination.z&&e.destination.y>=r.destination.y){t=n+1;break}}i.splice(t,0,e)},this.idle=function(){this.shaking={current:!1,duration:0,easing:null,elapsed:0,force:{x:0,y:0},shift:{x:0,y:0}}},this.look=function(e,t){this.position.x=e,this.position.y=t},this.render=function(){var t=this;i.forEach((function(n){var i=n.destination,r=n.frame,s=n.opacity,o=n.source,a=t.visible(i.x*t.screen.scale(),i.y*t.screen.scale(),i.width*t.screen.scale(),i.height*t.screen.scale());if(s>0&&!0===a){var c=e.globalAlpha;e.globalAlpha=s;var u={destination:{x:t.screen.x()+i.x*t.screen.scale()-(t.position.x()*t.screen.scale()-t.screen.width()/2+t.shaking.shift.x*t.screen.scale()),y:t.screen.y()+i.y*t.screen.scale()-(t.position.y()*t.screen.scale()-t.screen.height()/2+t.shaking.shift.y*t.screen.scale()),width:i.width*t.screen.scale(),height:i.height*t.screen.scale()}},h={top:Math.min(0,u.destination.y-t.screen.y()),right:Math.max(0,u.destination.x+u.destination.width-(t.screen.x()+t.screen.width())),bottom:Math.max(0,u.destination.y+u.destination.height-(t.screen.y()+t.screen.height())),left:Math.min(0,u.destination.x-t.screen.x())};e.drawImage(o,r.x-h.left*(r.width/u.destination.width),r.y-h.top*(r.height/u.destination.height),r.width-h.right*(r.width/u.destination.width)-Math.abs(h.left*(r.width/u.destination.width)),r.height-h.bottom*(r.height/u.destination.height)-Math.abs(h.top*(r.height/u.destination.height)),u.destination.x-h.left,u.destination.y-h.top,u.destination.width-h.right-Math.abs(h.left),u.destination.height-h.bottom-Math.abs(h.top)),e.globalAlpha=c}})),i=[]},this.shake=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.e(r.b(2));this.idle(),this.shaking.force={x:e,y:t},this.shaking.current=!0,this.shaking.duration=n,this.shaking.easing=i},this.update=function(e){if(!1!==this.shaking.current)if(this.shaking.elapsed+e>=this.shaking.duration)this.idle();else{this.shaking.elapsed+=e;var t=this.shaking.easing(this.shaking.elapsed/this.shaking.duration),n=2*Math.random()*Math.PI;this.shaking.shift.x=Math.round(Math.cos(n)*this.shaking.force.x*t),this.shaking.shift.y=Math.round(Math.sin(n)*this.shaking.force.y*t)}},this.visible=function(e,t,n,i){var r=this.position.x()*this.screen.scale()-this.screen.width()/2+this.shaking.shift.x*this.screen.scale(),s=this.position.y()*this.screen.scale()-this.screen.height()/2+this.shaking.shift.y*this.screen.scale(),o=this.screen.width(),a=this.screen.height();return!(e+n<=r||e>=r+o||t+i<=s||t>=s+a)}}var o=[];function a(e,t,n){var i={};function r(){for(var e in i)i.hasOwnProperty(e)&&!0===i[e]&&(i[e]=!1,n.push({type:"KEYBOARD",action:e,state:"UP"}))}function s(e){var r="KEY_"+o[e.keyCode];-1!==t.indexOf(r)&&!1===i[r]&&(e.preventDefault(),i[r]=!0,n.push({type:"KEYBOARD",action:r,state:"DOWN"}))}function a(e){var r="KEY_"+o[e.keyCode];-1!==t.indexOf(r)&&!0===i[r]&&(e.preventDefault(),i[r]=!1,n.push({type:"KEYBOARD",action:r,state:"UP"}))}function c(){e.addEventListener("blur",r),e.addEventListener("keydown",s),e.addEventListener("keyup",a)}t.forEach((function(e){i[e]=!1})),c.call(this),this.destroy=function(){e.removeEventListener("blur",r),e.removeEventListener("keydown",s),e.removeEventListener("keyup",a)},this.setup=c}function c(e,t,n){function i(e){-1!==t.indexOf("CLICK_RIGHT")&&e.preventDefault()}function r(e){var i=e.button,r=["LEFT","MIDDLE","RIGHT"];if(void 0!==r[i]){var s="CLICK_"+r[i];if(-1!==t.indexOf(s)){e.preventDefault();var o=e.target.getBoundingClientRect(),a=e.clientX-o.left,c=e.clientY-o.top;n.push({type:"MOUSE",action:s,state:"DOWN",x:a,y:c})}}}function s(e){if(-1!==t.indexOf("MOVE")){e.preventDefault();var i=e.target.getBoundingClientRect(),r=e.clientX-i.left,s=e.clientY-i.top;n.push({type:"MOUSE",action:"MOVE",state:"ENTER",x:r,y:s})}}function o(e){if(-1!==t.indexOf("MOVE")){e.preventDefault();var i=e.target.getBoundingClientRect(),r=e.clientX-i.left,s=e.clientY-i.top;n.push({type:"MOUSE",action:"MOVE",state:"LEAVE",x:r,y:s})}}function a(e){if(-1!==t.indexOf("MOVE")){e.preventDefault();var i=e.target.getBoundingClientRect(),r=e.clientX-i.left,s=e.clientY-i.top;n.push({type:"MOUSE",action:"MOVE",x:r,y:s})}}function c(e){var i=e.button,r=["LEFT","MIDDLE","RIGHT"];if(void 0!==r[i]){var s="CLICK_"+r[i];if(-1!==t.indexOf(s)){e.preventDefault();var o=e.target.getBoundingClientRect(),a=e.clientX-o.left,c=e.clientY-o.top;n.push({type:"MOUSE",action:s,state:"UP",x:a,y:c})}}}function u(){e.addEventListener("contextmenu",i),e.addEventListener("mousedown",r),e.addEventListener("mouseenter",s),e.addEventListener("mouseleave",o),e.addEventListener("mousemove",a),e.addEventListener("mouseup",c),e.addEventListener("wheel",h)}function h(e){if(-1!==t.indexOf("SCROLL")){e.preventDefault();var i,r=e.target.getBoundingClientRect(),s=e.clientX-r.left,o=e.clientY-r.top;Math.abs(e.deltaY)>=Math.abs(e.deltaX)?(i="DOWN",e.deltaY<0&&(i="UP")):(i="RIGHT",e.deltaX<0&&(i="LEFT")),n.push({type:"MOUSE",action:"SCROLL",state:i,x:s,y:o})}}u.call(this),this.destroy=function(){e.removeEventListener("contextmenu",i),e.removeEventListener("mousedown",r),e.removeEventListener("mouseenter",s),e.removeEventListener("mouseleave",o),e.removeEventListener("mousemove",a),e.removeEventListener("mouseup",c),e.removeEventListener("wheel",h)},this.setup=u}function u(e,t){var n=[],i=[];(function(){n.push(new a(e,t,i)),n.push(new c(e,t,i))}).call(this),this.destroy=function(){n.forEach((function(e){e.destroy()}))},this.inputs=i}o[9]="TAB",o[13]="ENTER",o[16]="SHIFT",o[17]="CTRL",o[18]="ALT",o[27]="ESC",o[32]="SPACE",o[37]="LEFT",o[38]="UP",o[39]="RIGHT",o[40]="DOWN",o[48]="ZERO",o[49]="ONE",o[50]="TWO",o[51]="THREE",o[52]="FOUR",o[53]="FIVE",o[54]="SIX",o[55]="SEVEN",o[56]="EIGHT",o[57]="NINE",o[65]="A",o[66]="B",o[67]="C",o[68]="D",o[69]="E",o[70]="F",o[71]="G",o[72]="H",o[73]="I",o[74]="J",o[75]="K",o[76]="L",o[77]="M",o[78]="N",o[79]="O",o[80]="P",o[81]="Q",o[82]="R",o[83]="S",o[84]="T",o[85]="U",o[86]="V",o[87]="W",o[88]="X",o[89]="Y",o[90]="Z";var h=n(3),f=n(0),l=n(1),d=n(5),m=n(15);function p(){var e=this;console.log("start demo scene"),this.$controllers=new u(this.element,this.models.scenes[this.currentScene].inputs()),this.$world=new h.b(this),this.$infos={started:!1},this.$origins={default:{x:function(){return 0},y:function(){return 0},z:function(){return 0},scale:function(){return 1}}};var t=function(){return Math.min(e.size.width/160,e.size.height/144)};this.$camera=new s(this.context,"default",{x:function(){return(e.size.width-160*t())/2},y:function(){return(e.size.height-144*t())/2},width:function(){return 160*t()},height:function(){return 144*t()},scale:t}),this.$cameraInfo=new s(this.context,"info",{x:function(){return(e.size.width-160*t())/2},y:function(){return(e.size.height-144*t())/2},width:function(){return 160*t()},height:function(){return 144*t()},scale:t}),this.$renderers=f.a.call(this),this.$systems=l.a.call(this);var n=i.c.call(this);this.$world.add(n),d.generateDecor.call(this,[]),this.$camera.look((function(){return e.$world.entities.character.get("position").x+48}),(function(){return 72}));var r=m.a("bestScore");null!=r&&(this.$world.entities.bestScore.get("score").value=r)}},function(e,t,n){e.exports=n(32)},function(e,t,n){var i={"./datasets/common/inputs.json":[33,41],"./images/common/placeholder-8x1.png":[34,21],"./images/demo/all-flappy-bird-16x16@1x.png":[35,22],"./images/demo/background-16x16@1x.png":[36,23],"./images/demo/best-48x16@1x.png":[37,24],"./images/demo/character-32x32.png":[38,25],"./images/demo/clouds-160x16@1x.png":[39,26],"./images/demo/flappy-bird-16x16@1x.png":[40,27],"./images/demo/flappy-bird-shadow-16x8@1x.png":[41,28],"./images/demo/foreground-16x16@1x.png":[42,29],"./images/demo/game-over-64x64@1x.png":[43,30],"./images/demo/numbers-8x16@1x.png":[44,31],"./images/demo/numbers-blue-8x16@1x.png":[45,32],"./images/demo/pipe-16x16@1x.png":[46,33],"./images/demo/pipe-shadow-16x8@1x.png":[47,34],"./images/demo/touch-screen-64x32@1x.png":[48,35],"./images/demo/waves-16x16@1x.png":[49,36],"./sounds/demo/explode.mp3":[50,37],"./sounds/demo/jump.mp3":[51,38],"./spritesheets/common/character-32x32.png":[52,39],"./spritesheets/common/spritesheet.png":[53,40]};function r(e){if(!n.o(i,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(i)},r.id=27,e.exports=r},function(e,t,n){var i={"./components/common/camera.json":[54,42],"./components/common/commands.json":[55,43],"./components/common/fade.json":[56,44],"./components/common/forces.json":[57,45],"./components/common/hitbox.json":[58,46],"./components/common/images.json":[59,47],"./components/common/inputs.json":[60,48],"./components/common/origin.json":[61,49],"./components/common/position.json":[62,50],"./components/common/timeout.json":[63,51],"./components/demo/decor.json":[64,52],"./components/demo/player.json":[65,53],"./components/demo/score.json":[66,54],"./entities/demo/background.json":[67,55],"./entities/demo/bestScore.json":[68,56],"./entities/demo/bestScoreStatic.json":[69,57],"./entities/demo/bottom.json":[70,58],"./entities/demo/character.json":[71,59],"./entities/demo/checkpoint.json":[72,60],"./entities/demo/cloud.json":[73,61],"./entities/demo/pipeBottom.json":[74,62],"./entities/demo/pipeTop.json":[75,63],"./entities/demo/score.json":[76,64],"./entities/demo/splashEnd.json":[77,65],"./entities/demo/top.json":[78,66],"./entities/demo/water.json":[79,67],"./scenes/demo/entities.json":[80,68],"./scenes/demo/inputs.json":[81,69],"./scenes/demo/renderers.json":[82,70],"./scenes/demo/systems.json":[83,71],"./snippets/demo/ease-in.js":[84,1],"./snippets/demo/ease-linear.js":[85,2],"./snippets/demo/ease-out.js":[86,3],"./snippets/demo/fade-ending.js":[87,4],"./snippets/demo/forces-down.js":[88,5],"./snippets/demo/forces-ending.js":[89,6],"./snippets/demo/forces-handling.js":[90,7],"./snippets/demo/handle-hitbox-score.js":[91,8],"./snippets/demo/handle-hitbox.js":[92,9],"./snippets/demo/timeout-ending.js":[93,10],"./systems/common/fade.js":[94,11],"./systems/common/forces.js":[95,12],"./systems/common/hitbox.js":[103,13],"./systems/common/images.js":[96,14],"./systems/common/inputs.js":[97,15],"./systems/common/previous.js":[98,16],"./systems/common/showHitbox.js":[12],"./systems/common/spritesheets.js":[99,17],"./systems/common/timeout.js":[100,18],"./systems/demo/commands.js":[101,19],"./systems/demo/generateDecor.js":[5],"./systems/demo/updateScore.js":[102,20]};function r(e){if(!n.o(i,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],r=t[0];return Promise.all(t.slice(1).map(n.e)).then((function(){return n(r)}))}r.keys=function(){return Object.keys(i)},r.id=28,e.exports=r},function(e,t,n){var i={"./demo/index.js":30,"./loading/index.js":31};function r(e){var t=s(e);return n(t)}function s(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}r.keys=function(){return Object.keys(i)},r.resolve=s,e.exports=r,r.id=29},function(e,t,n){"use strict";n.r(t),function(e){var i=n(8);n.d(t,"after",(function(){return i.a}));var r=n(9);n.d(t,"before",(function(){return r.a}));var s=n(10);n.d(t,"destroy",(function(){return s.a}));var o=n(11);n.d(t,"render",(function(){return o.a}));var a=n(13);n.d(t,"resize",(function(){return a.a}));var c=n(14);n.d(t,"setup",(function(){return c.a}));var u=n(25);n.d(t,"start",(function(){return u.a}));var h=n(16);n.d(t,"update",(function(){return h.a})),void 0!==e.hot&&e.hot.accept(["./after.js","./before.js","./destroy.js","./render.js","./resize.js","./setup.js","./start.js","./update.js"])}.call(this,n(7)(e))},function(e,t,n){"use strict";n.r(t),function(e){var i=n(17);n.d(t,"after",(function(){return i.a}));var r=n(18);n.d(t,"before",(function(){return r.a}));var s=n(19);n.d(t,"destroy",(function(){return s.a}));var o=n(20);n.d(t,"render",(function(){return o.a}));var a=n(21);n.d(t,"resize",(function(){return a.a}));var c=n(22);n.d(t,"setup",(function(){return c.a}));var u=n(23);n.d(t,"start",(function(){return u.a}));var h=n(24);n.d(t,"update",(function(){return h.a})),void 0!==e.hot&&e.hot.accept(["./after.js","./before.js","./destroy.js","./render.js","./resize.js","./setup.js","./start.js","./update.js"])}.call(this,n(7)(e))},function(e,t,n){"use strict";function i(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=document.createElement("canvas"),o=s.getContext(e);function a(){s.setAttribute("tabindex",0),s.focus()}function c(e,t){var n=window.devicePixelRatio||1;!0===r&&(n=Math.floor(n)),s.setAttribute("height",n*t),s.setAttribute("width",n*e),s.style.height="100%",s.style.width="100%",o.scale(n,n),!0===r&&u()}function u(){s.style.imageRendering="-moz-crisp-edges",s.style.imageRendering="-webkit-crisp-edges",s.style.imageRendering="crisp-edges",s.style.imageRendering="pixelated",o.imageSmoothingEnabled=!1}s.setAttribute("id",t),s.addEventListener("mousedown",a),c(n,i),this.context=o,this.element=s,this.focus=a,this.resize=c}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=0,r=null,s=!1;function o(){var t=performance.now();if(null!==r&&!1===s)for(i+=t-r;i>=1e3/this.framerate/this.speed&&!1===s;)i>=5e3?(console.log("droped",i),e(i-=i)):(i-=1e3/this.framerate/this.speed,e(1e3/this.framerate));requestAnimationFrame(this.update.bind(this)),r=t}function a(){s=!0}function c(){s=!1}function u(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;requestAnimationFrame((function(){for(;n--;)e(1e3/t.framerate)}))}this.framerate=t,this.speed=n,this.pause=a,this.play=c,this.tick=u,this.update=o}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n.r(t);var o=function(){var e=this;return new Promise((function(t,i){var r=n(27),o=[];e.assetsLoaded=[],r.keys().forEach((function(t){var n=new Promise((function(n,i){r(t).then((function(i){var r=e.assetsLoaded.find((function(e){return e.key==t}));if(r&&r.source!=i||void 0===r){if(void 0!==r&&r.source!=i){var o=e.assetsLoaded.indexOf(r);o>-1&&e.assetsLoaded.splice(o,1)}(function(e,t){return new Promise((function(n,i){console.log("load assets or reload");var r=s(e.match(/(?!\.\/|\/)(.+?)(?=(?:\.[^\.\/]+$)|\/)/g),3),o=r[0],a=r[1],c=r[2],u={key:e,name:c,scope:a,source:t,type:o.substring(0,o.length-1)};if("dataset"===u.type&&(u.getter=function(){return u.source},n(u)),"image"===u.type||"spritesheet"===u.type){var h=new Image;h.src=u.source,h.onload=function(){u.getter=function(){return h},n(u)}}else if("sound"===u.type){var f=new Audio(u.source);f.oncanplaythrough=function(){u.getter=function(){return f.cloneNode()},n(u)}}}))})(t,i).then((function(t){e.assetsLoaded.push(t),void 0===e.assets[t.type+"s"]&&(e.assets[t.type+"s"]={}),void 0===e.assets[t.type+"s"][t.scope]&&(e.assets[t.type+"s"][t.scope]={}),e.assets[t.type+"s"][t.scope][t.name]=t.getter}))}n(i)}))}));o.push(n)})),Promise.all(o).then((function(e){t()}))}))};function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var c=function(){var e=this;return new Promise((function(t,i){var r=n(28),s=[];e.modelsLoaded=[],r.keys().forEach((function(t){var n=new Promise((function(n,i){r(t).then((function(i){var r=e.modelsLoaded.find((function(e){return e.key==t}));if(r&&r.source!=i||void 0===r){if(void 0!==r&&r.source!=i){var s=e.modelsLoaded.indexOf(r);s>-1&&e.modelsLoaded.splice(s,1)}u.call(e,t,i).then((function(t){e.modelsLoaded.push(t),void 0===e.models[t.type+"s"]&&(e.models[t.type+"s"]={}),void 0===e.models[t.type+"s"][t.scope]&&(e.models[t.type+"s"][t.scope]={}),e.models[t.type+"s"][t.scope][t.name]=t.getter}))}n(i)}))}));s.push(n)})),Promise.all(s).then((function(e){t()}))}))};function u(e,t){var n=this;return new Promise((function(i,r){console.log("load models or reload");var s=a(e.match(/(?!\.\/|\/)(.+?)(?=(?:\.[^\.\/]+$)|\/)/g),3),o=s[0],c=s[1],u=s[2],h={key:e,name:u,scope:c,source:t,type:o.substring(0,o.length-1)};"snippets"===o?(h.getter=h.source.default.bind(n),i(h)):h.getter=function(){return h.source},i(h)}))}var h=function(){var e=this,t=n(29);t.keys().forEach((function(n){var i=n.match(/^\.\/([^\/]+)\/index\.js$/)[1];e.scenes[i]=t(n)}))};new function(e){var t=e.container,n=e.expose||!1,s=e.framerate||60,a=e.sharp||!1,u=e.speed||1,f={height:t.offsetHeight,width:t.offsetWidth},l=null,d=null,m=!1,p=0;function y(e){this.delta=e,t.offsetWidth===this.size.width&&t.offsetHeight===this.size.height||g.call(this),!0===this.playing&&this.tick(),this.scene.before.call(this),p>0&&v.call(this),this.scene.render.call(this),this.scene.after.call(this)}function g(){this.size.width=t.offsetWidth,this.size.height=t.offsetHeight,l.resize(this.size.width,this.size.height),this.scene.resize.call(this)}function v(){for(;p>0;)this.scene.update.call(this),p-=1,!0!==m?null===d||(this.scene.destroy.call(this),this.scene=this.scenes[d],this.currentScene=d,this.scene.setup.call(this),this.scene.start.call(this),d=null):(this.scene.start.call(this),m=!1)}this.playing=!0,this.preloading=!0,this.currentScene,this.$={},this.scenes={},this.size=f,this.snippets={},this.state={},this.version="0.39.0",this.cachedEntities={},this.load=function(e){d=e},this.pause=function(){this.playing=!1},this.play=function(){this.playing=!0},this.restart=function(){m=!0},this.tick=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;p+=e},function(){var e=this;l=new i("2d","theatre",this.size.width,this.size.height,a),t.appendChild(l.element),l.focus(),this.container=t,this.context=l.context,this.element=l.element,this.models={},this.assets={},this.delta=0,this.loop=new r(y.bind(this),s,u);var n=o.call(this),f=c.call(this);h.call(this),Promise.all([n,f]).then((function(t){e.preloading=!1})),this.scene=this.scenes.loading,this.scene.setup.call(this),this.scene.start.call(this),this.loop.update()}.call(this,e),!0===n&&(window.theatre=this)}({container:document.body.querySelector(".theatre-container"),expose:!0,sharp:!0})}]);
//# sourceMappingURL=index.js.map